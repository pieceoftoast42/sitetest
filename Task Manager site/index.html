import React, { useEffect, useState } from "react";
import TaskForm from "./TaskForm";
import TaskList from "./TaskList";
import Login from "./Login";
import Signup from "./Signup";
import "./styles/general.css";

function App() {
  const [currentUser, setCurrentUser] = useState(null);
  const [mode, setMode] = useState("login"); // login or signup
  const [tasks, setTasks] = useState([]);

  // Load tasks for logged in user
  useEffect(() => {
    if (currentUser) {
      const saved = JSON.parse(localStorage.getItem(`tasks_${currentUser}`)) || [];
      setTasks(saved);
    }
  }, [currentUser]);

  // Save tasks for the logged in user
  const saveTasks = (updated) => {
    setTasks(updated);
    if (currentUser) {
      localStorage.setItem(`tasks_${currentUser}`, JSON.stringify(updated));
    }
  };

  // Logout
  const logout = () => {
    setCurrentUser(null);
  };

  // If NOT logged in → show login/signup page
  if (!currentUser) {
    return mode === "login" ? (
      <Login setCurrentUser={setCurrentUser} switchToSignup={() => setMode("signup")} />
    ) : (
      <Signup setCurrentUser={setCurrentUser} />
    );
  }

  // If logged in → show main app
  return (
    <div style={{ display: "flex", height: "100vh" }}>
      <div
        style={{
          background: "#1e1e1e",
          color: "white",
          width: "200px",
          paddingTop: "20px",
        }}
      >
        <button
          style={{
            width: "100%",
            background: "#333",
            color: "white",
            border: "none",
            padding: "10px",
            cursor: "pointer",
          }}
          onClick={logout}
        >
          Logout
        </button>

        <div style={{ padding: "10px" }}>
          <p>Logged in as:</p>
          <strong>{currentUser}</strong>
        </div>
      </div>

      <div style={{ flexGrow: 1, padding: "20px" }}>
        <h1>PinTask</h1>
        <TaskForm tasks={tasks} saveTasks={saveTasks} />
        <TaskList tasks={tasks} saveTasks={saveTasks} />
      </div>
    </div>
  );
}

export default App;
